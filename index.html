<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MinecraftæœåŠ¡å™¨çŠ¶æ€é¢æ¿</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://list.mczfw.cn/mczfw.js" async></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #e9ecef;
            color: #343a40;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        ã€‚server-panel {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 650px;
            overflow: hidden;
        }

        ã€‚header {
            display: flex;
            align-items: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .server-icon {
            width: 64px;
            height: 64px;
            border-radius: 8px;
            margin-right: 20px;
            background-color: #ced4da;
            object-fit: cover;
        }
        
        .server-icon[logo="fishp.9666.fun:22901"] {
            font-size: 0;
        }

        .header-info {
            flex-grow: 1;
        }

        .server-address {
            font-size: 1.5em;
            font-weight: 700;
            margin: 0;
            color: #212529;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
            margin-top: 8px;
        }

        .status-badge.online {
            background-color: #d4edda;
            color: #155724;
        }

        .status-badge.offline {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-badge.loading {
            background-color: #e2e3e5;
            color: #383d41;
        }
        
        .status-badge i {
            margin-right: 6px;
        }

        .info-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .info-item .icon {
            font-size: 1.8em;
            color: #007bff;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }
        
        .info-item-content h4 {
            margin: 0 0 4px 0;
            color: #495057;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .info-item-content p {
            margin: 0;
            font-size: 1.2em;
            font-weight: 700;
            color: #212529;
        }

        .motd-container {
            padding: 0 20px 20px;
        }
        
        .motd {
            background-color: #212529;
            color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            text-align: left;
            border: 1px solid #343a40;
        }
        
        .motd h4 {
            margin: 0 0 10px 0;
            border-bottom: 1px solid #495057;
            padding-bottom: 10px;
            color: #adb5bd;
        }

        .news-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 650px;
            margin-top: 20px;
            padding: 20px;
        }

        .news-container h3 {
            margin-top: 0;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
            color: #212529;
        }

        .news-container p,
        .news-container li,
        .news-container blockquote {
            color: #495057;
        }

        .news-container blockquote {
            border-left: 4px solid #007bff;
            padding-left: 10px;
            margin: 10px 0;
            color: #6c757d;
        }

        .api-indicator {
            font-size: 0.75em;
            color: #6c757d;
            margin-top: 4px;
        }
    </style>
</head>
<body>

    <div class="server-panel">
        <div class="header">
            <span class="server-icon" logo="fishp.9666.fun:22901"></span>
            
            <div class="header-info">
                <p class="server-address">fishp.9666.fun:22901</p>
                <div id="status-display" class="status-badge loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>æŸ¥è¯¢ä¸­...</span>
                </div>
                <div id="api-indicator" class="api-indicator"></div>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-item">
                <i class="fas fa-users icon"></i>
                <div class="info-item-content">
                    <h4>åœ¨çº¿ç©å®¶</h4>
                    <p><span ip="fishp.9666.fun:22901" id="players-count">æŸ¥è¯¢ä¸­</span></p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-signal icon"></i>
                <div class="info-item-content">
                    <h4>ç½‘ç»œå»¶è¿Ÿ</h4>
                    <p><span ping="fishp.9666.fun:22901" id="ping-value">æŸ¥è¯¢ä¸­</span> ms</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-map-marker-alt icon"></i>
                <div class="info-item-content">
                    <h4>æœåŠ¡å™¨ä½ç½®</h4>
                    <p><span city="fishp.9666.fun:22901" id="location-info">æŸ¥è¯¢ä¸­</span></p>
                </div>
            </div>
        </div>
        
        <div class="motd-container">
            <div class="motd">
                 <h4>æœåŠ¡å™¨ä¿¡æ¯ (MOTD)</h4>
                 <span motd="fishp.9666.fun:22901" id="motd-content">æŸ¥è¯¢ä¸­...</span>
            </div>
        </div>

    </div>
    
    <script>
        // é…ç½®
        const SERVER_FULL_ADDRESS = 'fishp.9666.fun:22901';
        const [SERVER_HOST, SERVER_PORT] = SERVER_FULL_ADDRESS.split(':');
        const BACKUP_API = 'https://api.wer.plus/api/mcse';
        const PRIMARY_TIMEOUT = 8000; // ä¸»APIè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        
        let backupAPIUsed = false;
        let primaryAPIFailed = false;

        // å¤‡ç”¨APIæŸ¥è¯¢å‡½æ•°
        async function queryBackupAPI() {
            try {
                console.log('æ­£åœ¨ä½¿ç”¨å¤‡ç”¨APIæŸ¥è¯¢æœåŠ¡å™¨çŠ¶æ€...');
                const url = `${BACKUP_API}?host=${SERVER_HOST}&port=${SERVER_PORT}`;
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.code === 200 && result.data) {
                    return result.data;
                } else {
                    console.error('å¤‡ç”¨APIè¿”å›é”™è¯¯:', result.msg);
                    return null;
                }
            } catch (error) {
                console.error('å¤‡ç”¨APIæŸ¥è¯¢å¤±è´¥:', error);
                return null;
            }
        }

        // æ›´æ–°é¡µé¢æ˜¾ç¤º
        function updateDisplay(data) {
            const statusDisplay = document.getElementById('status-display');
            const apiIndicator = document.getElementById('api-indicator');
            const playersCount = document.getElementById('players-count');
            const pingValue = document.getElementById('ping-value');
            const locationInfo = document.getElementById('location-info');
            const motdContent = document.getElementById('motd-content');
            const serverIcon = document.querySelector('.server-icon');

            // æ›´æ–°çŠ¶æ€æ ‡è¯†
            statusDisplay.className = 'status-badge online';
            statusDisplay.innerHTML = `<i class="fas fa-check-circle"></i><span>åœ¨çº¿</span>`;
            
            if (backupAPIUsed) {
                apiIndicator.textContent = 'ğŸ“¡ ä½¿ç”¨å¤‡ç”¨APIæŸ¥è¯¢';
            }

            // æ›´æ–°åœ¨çº¿ç©å®¶
            if (data.onl_l !== undefined && data.max_l !== undefined) {
                playersCount.textContent = `${data.onl_l} / ${data.max_l}`;
            }

            // æ›´æ–°å»¶è¿Ÿ
            if (data.serv_ping !== undefined && data.serv_ping !== null) {
                pingValue.textContent = data.serv_ping;
            }

            // æ›´æ–°æœåŠ¡å™¨å›¾æ ‡
            if (data.serv_ico && serverIcon.tagName === 'SPAN') {
                const img = document.createElement('img');
                img.src = data.serv_ico;
                img.className = 'server-icon';
                img.alt = 'Server Icon';
                serverIcon.replaceWith(img);
            }

            // æ›´æ–°MOTD
            if (data.serv_name) {
                motdContent.textContent = data.serv_name;
                if (data.serv_ver) {
                    motdContent.textContent += `\nç‰ˆæœ¬: ${data.serv_ver}`;
                }
            }

            // æ³¨æ„ï¼šå¤‡ç”¨APIå¯èƒ½ä¸æä¾›ä½ç½®ä¿¡æ¯
            // å¦‚æœéœ€è¦ä½ç½®ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦ä¿ç•™åŸAPIçš„ç›‘å¬æˆ–ä½¿ç”¨å…¶ä»–æ–¹å¼
        }

        // æ˜¾ç¤ºç¦»çº¿çŠ¶æ€
        function showOfflineStatus(reason = 'ç¦»çº¿') {
            const statusDisplay = document.getElementById('status-display');
            const apiIndicator = document.getElementById('api-indicator');
            
            statusDisplay.className = 'status-badge offline';
            statusDisplay.innerHTML = `<i class="fas fa-times-circle"></i><span>${reason}</span>`;
            
            if (backupAPIUsed) {
                apiIndicator.textContent = 'ğŸ“¡ å¤‡ç”¨APIä¹Ÿæ— æ³•è¿æ¥';
            }
        }

        // ä¸»ç›‘æ§é€»è¾‘
        document.addEventListener('DOMContentLoaded', () => {
            const onlinePlayersSpan = document.querySelector(`span[ip="${SERVER_FULL_ADDRESS}"]`);

            if (!onlinePlayersSpan) {
                console.error('æ— æ³•æ‰¾åˆ°ç”¨äºç›‘æ§çš„ span å…ƒç´ ã€‚');
                return;
            }

            let statusUpdated = false;

            // ç›‘æ§ä¸»APIï¼ˆmczfw.jsï¼‰
            const observer = new MutationObserver((mutationsList) => {
                for(let mutation of mutationsList) {
                    if (mutation.type === 'childList' || mutation.type === 'characterData') {
                        const content = onlinePlayersSpan.textContent.trim();
                        
                        if (content.includes('/') && !content.includes('æŸ¥è¯¢ä¸­')) {
                            // ä¸»APIæˆåŠŸè¿”å›æ•°æ®
                            const statusDisplay = document.getElementById('status-display');
                            statusDisplay.className = 'status-badge online';
                            statusDisplay.innerHTML = `<i class="fas fa-check-circle"></i><span>åœ¨çº¿</span>`;
                            statusUpdated = true;
                            observer.disconnect();
                        } else if (content === 'ç¦»çº¿' || content.includes('é”™è¯¯')) {
                            // ä¸»APIè¿”å›ç¦»çº¿
                            primaryAPIFailed = true;
                            observer.disconnect();
                            // å°è¯•å¤‡ç”¨API
                            tryBackupAPI();
                        }
                    }
                }
            });

            const config = { childList: true, subtree: true, characterData: true };
            observer.observe(onlinePlayersSpan, config);
            
            // ä¸»APIè¶…æ—¶å¤„ç†
            setTimeout(() => {
                if (!statusUpdated && !primaryAPIFailed) {
                    console.log('ä¸»APIè¶…æ—¶ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨API...');
                    observer.disconnect();
                    tryBackupAPI();
                }
            }, PRIMARY_TIMEOUT);

            // å°è¯•ä½¿ç”¨å¤‡ç”¨API
            async function tryBackupAPI() {
                backupAPIUsed = true;
                const data = await queryBackupAPI();
                
                if (data) {
                    updateDisplay(data);
                } else {
                    showOfflineStatus('æ— æ³•è¿æ¥');
                }
            }
        });
    </script>

    <!-- èµ„è®¯æ  -->
    <div id="news-section" class="news-container">
        <h3>ğŸ“¢ æœ€æ–°èµ„è®¯</h3>
        <div id="news-content"></div>
    </div>

    <!-- å¼•å…¥ marked.js ç”¨äºæ¸²æŸ“ Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        // ç¤ºä¾‹ Markdown å†…å®¹
        const markdownNews = `
# æ¬¢è¿æ¥åˆ°Fishpçš„æœåŠ¡å™¨ã€‚
å§‹äº2025/9/20ã€‚
        `;

        // æ¸²æŸ“ Markdown
        document.getElementById("news-content").innerHTML = marked.parse(markdownNews);
    </script>

</body>
</html>
